<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Narrative Visualization</title>
    <!-- D3.js Library -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!-- CSS Styles -->
    <style>
        body {
            font-family: Arial, sans-serif;
            color: #505143; /* Set font color */
            background-color: #9C9E84; /* Set background color */
        }
        #visualization {
            width: 800px;
            height: 600px;
            margin: 0 auto;
        }
        h1 {
            font-size: 50px; /* Increase font size */
            font-weight: bold; /* Make font bold */
            text-align: center; /* Center align the header */
        }
    </style>
</head>
<body>
    <h1>Overview of Covid cases and deaths between March 2020 till the end of March 2021</h1>
    <div id="visualization">
        <svg width="800" height="600"></svg>
    </div>

    <!-- JavaScript Code -->
    <script>
        async function init() {
            // Load the data
            const data = await d3.csv('./facilities.csv');

            // Parse the data and handle potential zero values for logarithmic scales
            data.forEach(d => {
                d.total_inmate_cases = +d.total_inmate_cases || 1; // Handle zero values for log scale
                d.total_officer_cases = +d.total_officer_cases || 1; // Handle zero values for log scale
            });

            console.log(data); // Debugging: check the parsed data

            // Define dimensions and margins
            const margin = {top: 50, right: 50, bottom: 50, left: 50},
                  width = 800 - margin.left - margin.right,
                  height = 600 - margin.top - margin.bottom;

            // Append SVG and group element
            const svg = d3.select("#visualization svg")
                          .attr("width", width + margin.left + margin.right)
                          .attr("height", height + margin.top + margin.bottom)
                          .append("g")
                          .attr("transform", `translate(${margin.left},${margin.top})`);

            // Calculate x and y values using your formula
            data.forEach(d => {
                d.xValue = d.total_inmate_cases > 0 ? Math.log(d.total_inmate_cases) + ((Math.random() - 0.5) * 0.2) : (Math.log(0.5) + (Math.random() - 0.5) * 0.5);
                d.yValue = d.total_officer_cases > 0 ? Math.log(d.total_officer_cases) + ((Math.random() - 0.5) * 0.2) : (Math.log(0.5) + (Math.random() - 0.5) * 0.5);
            });

            // Create the x scale using scaleLinear for transformed values
            const x = d3.scaleLinear()
                        .domain([d3.min(data, d => d.xValue), d3.max(data, d => d.xValue)])
                        .range([0, width]);

            // Create the y scale using scaleLinear for transformed values
            const y = d3.scaleLinear()
                        .domain([d3.min(data, d => d.yValue), d3.max(data, d => d.yValue)])
                        .range([height, 0]);

            // Add x axis
            const xAxis = d3.axisBottom(x).ticks(10);
            svg.append("g")
               .attr("transform", `translate(0,${height})`)
               .call(xAxis);

            // Add y axis
            const yAxis = d3.axisLeft(y).ticks(10);
            svg.append("g")
               .call(yAxis);

            // Create scatter plot
            svg.selectAll("circle")
               .data(data)
               .enter()
               .append("circle")
               .attr("cx", d => x(d.xValue))
               .attr("cy", d => y(d.yValue))
               .attr("r", 5)
               .style("fill", "blue");
        }

        init();
    </script>
</body>
</html>
